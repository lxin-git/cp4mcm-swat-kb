{"componentChunkName":"component---src-pages-cp-4-i-guides-aspera-proxy-cp-4-i-index-mdx","path":"/cp4i-guides/aspera-proxy-cp4i/","result":{"pageContext":{"frontmatter":{"title":"Configure Aspera Proxy for use with CP4I","description":"Configure Aspera Proxy for use with CP4I","keywords":"Aspera Proxy, CP4I"},"relativePagePath":"/cp4i-guides/aspera-proxy-cp4i/index.mdx","titleType":"page","MdxNode":{"id":"98a2f07d-18c7-547d-8d3c-ea0b11a3f40e","children":[],"parent":"3b84bfc2-b4c0-51b8-8976-d5d7cf33b2f8","internal":{"content":"---\ntitle: Configure Aspera Proxy for use with CP4I\ndescription: Configure Aspera Proxy for use with CP4I\nkeywords: Aspera Proxy, CP4I\n---\n\nimport ArticleDetails from '../../../components/ArticleDetails'\n\n<ArticleDetails name=\"Ryan Hay\" lastUpdated=\"April 2020\" readTimeMinutes=\"3\" />\n\n<AnchorLinks>\n  <AnchorLink>Install Aspera Proxy</AnchorLink>\n  <AnchorLink>Configure the Server for use with Aspera Proxy</AnchorLink>\n  <AnchorLink>Configure Aspera Proxy</AnchorLink>\n  <AnchorLink>Example Proxy Config</AnchorLink>\n</AnchorLinks>\n\n## Install Aspera Proxy\n\n1. Provision a CentOS 7 machine (Debian is also supported)\n1. [Download](https://downloads.asperasoft.com/en/downloads/42) Aspera Proxy to the host\n1. As root install Aspera Proxy: `rpm -ivh ibm-aspera-proxy-1.4.4.174906-linux-64.rpm`\n\n## Configure the Server for use with Aspera Proxy\n\n1. Create the user xfer: `adduser xfer`\n1. Add ‘[aspera_id_dsa.pub](./asperaIdDsaPub.md)’ to '/home/xfer/.ssh/authorized_keys'\n\n   ```shell\n   command=\"/bin/aspshell -t\",no-agent-forwarding,no-port-forwarding,no-X11-forwarding,no-pty ssh-dss AAAAB3NzaC1kc3MAAACBAOQpAcPqbjIjGCOx7Lo+fLjppxlcRGwkfLnin8GpcjJiRU4CQSkqC9PepNM2bKRZbDii84/X4OLVz/YWlhyWVxOmGRZxLyUDuPTXaZQR5xdq9eM88bSLe3m+0HzEvLfeRDd72/38vCHTFxF+5rR3lR8XCikEgBe8kCvcHqtqmzz5AAAAFQC8LMnqrMdxKJQmglVyX/utXHiaaQAAAIA+g+0Q/jLMcbZe1zEJ9dpvi73MTrA/Ph48m3RROfd9S+dCYlPuLQpUJGveDYfY5kxYXXbLSNSrxAG5nayjcId57tbVWYB1s3sXFz5zJX2cTrNRGoBo/K3ZsT6uAzWk/otBRjGAPfEp2/Vkb6QMgMR/pTeieNwpuYDpyTFPoZq+gAAAAIEAobapDv5p2foH+cG5K07sIFD9r0RD7uKJnlqjYAXzFc8U76wXKgu6WXup2ac0Co+RnZp7Hsa9G+E+iJ6poI9pOR08XTdPly4yDULNST4PwlfrbSFT9FVhzkWfpOvAUc8fkQAhZqv/PE6VhFQ8w03Z8GpqXx7b3NvBR+EfIx368Ko= Aspera public access\n   command=\"/bin/aspshell -t\",no-agent-forwarding,no-port-forwarding,no-X11-forwarding,no-pty ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDgVtYAGrv/GSypo1IlauFMjDCawMoRQAvLO71Tc5KwlrAFRXklcTRZ2QXsiDHssh0KTVjmNSy7FXccMlJCXMATyXeR3sjY2Jdck3NWE89KFIaSp/+A6AFYv6rJqpq8axbHmBuQA7GRbOShWt15tZ0axWCP0sRr0291bDr9uWbgkFS0ljr53839AOZ9ebWcNWpAavB9FU5RMPwmYm2hhvhKM7S0qaq30gN3HmrERcNf3MenKXSuTp6hKO00D8ohWS5SJPsjut6O/aV4d66L3VD6PmN+JdxWrzzNWX7syvQd/W7ppfw2Z/Su8xh2nUC09G7ON3j6rlKX4Rk3jYgOM0i1y8VwCPnY2+DdRWyqwOFZlv5tmZVIYkC8UdhRu3hdImnnuDvHDL88g/CaEzuOGYLoMVtRH82gaoQY4n7jyJk4inc4d9i8Jknl6JtOPfc5peHRmHjnSupvuHaAs4aZp0waid/F4UyI0mCfIKe+/VbxyOZn9m4b38XCMoTyfEmjS7s59RhxfK7JEdzJC1lpWD93bZ/J6jzMzDJfJpN4cDISY9p3hLfR1M1tulF44scv56n38XDyzktj6dqa1P/hJOgOWhnsRe8TaiwdEA6EEqHwUEp2sSnLNnk5jfQetni3evzai4Ly58DKY+E31l5M60+CC2dMcHEJvF/5AqJmoPjOzQ== Aspera public access\n   ```\n\n1. Add 'Port 33001' to '/etc/ssh/sshd_config'\n1. Restart SSHD: `systemctl restart sshd`\n1. Copy the Aspera Proxy license file to '/opt/aspera/proxy/etc/aspera-license'\n1. Change the xfer users shell to the secure aspshell: `chsh -s /bin/aspshell xfer`\n1. Create the file '/etc/sudoers.d/aspera_rproxy' with the following content:\n\n   ```bash\n   Defaults:xfer !requiretty\n   Defaults:xfer secure_path = /sbin:/bin:/usr/sbin:/usr/bin\n   xfer ALL = NOPASSWD: /sbin/iptables-restore\n   ```\n\n## Configure Aspera Proxy\n\n1. Enable reverse proxy mode:\n   `/opt/aspera/proxy/bin/asconfigurator -x \"set_server_data;rproxy_enabled,true\"`\n\n1. Disbale UDP port reuse:\n   `./asconfigurator -x \"set_server_data;rproxy_rules_rule_udp_port_reuse,false\"`\n\n1. Set the reverse proxy rule to route traffic to the TCP proxy of the CP4I cluster:\n   `./asconfigurator -x \"set_server_data;rproxy_rules_rule_host,{aspera-tcp-proxy-address}:33001\"`\n\n## Example Proxy Config\n\n```xml\n<?xml version='1.0' encoding='UTF-8'?>\n<CONF version=\"2\">\n    <server>\n        <rproxy>\n            <enabled>true</enabled>\n            <rules>\n                <rule>\n                    <udp_port_reuse>false</udp_port_reuse>\n                    <squash_user>xfer</squash_user>\n                    <keyfile>/opt/aspera/proxy/etc/asperaweb_id_dsa.openssh</keyfile>\n                    <host>{aspera-tcp-proxy-address}:33001</host>\n                    <bind_source_address>{proxy_internal_interface}</bind_source_address>\n                </rule>\n            </rules>\n        </rproxy>\n    </server>\n</CONF>\n```\n","type":"Mdx","contentDigest":"7315327fef563e4a3f5ce91189c0e8b7","counter":198,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Configure Aspera Proxy for use with CP4I","description":"Configure Aspera Proxy for use with CP4I","keywords":"Aspera Proxy, CP4I"},"exports":{},"rawBody":"---\ntitle: Configure Aspera Proxy for use with CP4I\ndescription: Configure Aspera Proxy for use with CP4I\nkeywords: Aspera Proxy, CP4I\n---\n\nimport ArticleDetails from '../../../components/ArticleDetails'\n\n<ArticleDetails name=\"Ryan Hay\" lastUpdated=\"April 2020\" readTimeMinutes=\"3\" />\n\n<AnchorLinks>\n  <AnchorLink>Install Aspera Proxy</AnchorLink>\n  <AnchorLink>Configure the Server for use with Aspera Proxy</AnchorLink>\n  <AnchorLink>Configure Aspera Proxy</AnchorLink>\n  <AnchorLink>Example Proxy Config</AnchorLink>\n</AnchorLinks>\n\n## Install Aspera Proxy\n\n1. Provision a CentOS 7 machine (Debian is also supported)\n1. [Download](https://downloads.asperasoft.com/en/downloads/42) Aspera Proxy to the host\n1. As root install Aspera Proxy: `rpm -ivh ibm-aspera-proxy-1.4.4.174906-linux-64.rpm`\n\n## Configure the Server for use with Aspera Proxy\n\n1. Create the user xfer: `adduser xfer`\n1. Add ‘[aspera_id_dsa.pub](./asperaIdDsaPub.md)’ to '/home/xfer/.ssh/authorized_keys'\n\n   ```shell\n   command=\"/bin/aspshell -t\",no-agent-forwarding,no-port-forwarding,no-X11-forwarding,no-pty ssh-dss AAAAB3NzaC1kc3MAAACBAOQpAcPqbjIjGCOx7Lo+fLjppxlcRGwkfLnin8GpcjJiRU4CQSkqC9PepNM2bKRZbDii84/X4OLVz/YWlhyWVxOmGRZxLyUDuPTXaZQR5xdq9eM88bSLe3m+0HzEvLfeRDd72/38vCHTFxF+5rR3lR8XCikEgBe8kCvcHqtqmzz5AAAAFQC8LMnqrMdxKJQmglVyX/utXHiaaQAAAIA+g+0Q/jLMcbZe1zEJ9dpvi73MTrA/Ph48m3RROfd9S+dCYlPuLQpUJGveDYfY5kxYXXbLSNSrxAG5nayjcId57tbVWYB1s3sXFz5zJX2cTrNRGoBo/K3ZsT6uAzWk/otBRjGAPfEp2/Vkb6QMgMR/pTeieNwpuYDpyTFPoZq+gAAAAIEAobapDv5p2foH+cG5K07sIFD9r0RD7uKJnlqjYAXzFc8U76wXKgu6WXup2ac0Co+RnZp7Hsa9G+E+iJ6poI9pOR08XTdPly4yDULNST4PwlfrbSFT9FVhzkWfpOvAUc8fkQAhZqv/PE6VhFQ8w03Z8GpqXx7b3NvBR+EfIx368Ko= Aspera public access\n   command=\"/bin/aspshell -t\",no-agent-forwarding,no-port-forwarding,no-X11-forwarding,no-pty ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDgVtYAGrv/GSypo1IlauFMjDCawMoRQAvLO71Tc5KwlrAFRXklcTRZ2QXsiDHssh0KTVjmNSy7FXccMlJCXMATyXeR3sjY2Jdck3NWE89KFIaSp/+A6AFYv6rJqpq8axbHmBuQA7GRbOShWt15tZ0axWCP0sRr0291bDr9uWbgkFS0ljr53839AOZ9ebWcNWpAavB9FU5RMPwmYm2hhvhKM7S0qaq30gN3HmrERcNf3MenKXSuTp6hKO00D8ohWS5SJPsjut6O/aV4d66L3VD6PmN+JdxWrzzNWX7syvQd/W7ppfw2Z/Su8xh2nUC09G7ON3j6rlKX4Rk3jYgOM0i1y8VwCPnY2+DdRWyqwOFZlv5tmZVIYkC8UdhRu3hdImnnuDvHDL88g/CaEzuOGYLoMVtRH82gaoQY4n7jyJk4inc4d9i8Jknl6JtOPfc5peHRmHjnSupvuHaAs4aZp0waid/F4UyI0mCfIKe+/VbxyOZn9m4b38XCMoTyfEmjS7s59RhxfK7JEdzJC1lpWD93bZ/J6jzMzDJfJpN4cDISY9p3hLfR1M1tulF44scv56n38XDyzktj6dqa1P/hJOgOWhnsRe8TaiwdEA6EEqHwUEp2sSnLNnk5jfQetni3evzai4Ly58DKY+E31l5M60+CC2dMcHEJvF/5AqJmoPjOzQ== Aspera public access\n   ```\n\n1. Add 'Port 33001' to '/etc/ssh/sshd_config'\n1. Restart SSHD: `systemctl restart sshd`\n1. Copy the Aspera Proxy license file to '/opt/aspera/proxy/etc/aspera-license'\n1. Change the xfer users shell to the secure aspshell: `chsh -s /bin/aspshell xfer`\n1. Create the file '/etc/sudoers.d/aspera_rproxy' with the following content:\n\n   ```bash\n   Defaults:xfer !requiretty\n   Defaults:xfer secure_path = /sbin:/bin:/usr/sbin:/usr/bin\n   xfer ALL = NOPASSWD: /sbin/iptables-restore\n   ```\n\n## Configure Aspera Proxy\n\n1. Enable reverse proxy mode:\n   `/opt/aspera/proxy/bin/asconfigurator -x \"set_server_data;rproxy_enabled,true\"`\n\n1. Disbale UDP port reuse:\n   `./asconfigurator -x \"set_server_data;rproxy_rules_rule_udp_port_reuse,false\"`\n\n1. Set the reverse proxy rule to route traffic to the TCP proxy of the CP4I cluster:\n   `./asconfigurator -x \"set_server_data;rproxy_rules_rule_host,{aspera-tcp-proxy-address}:33001\"`\n\n## Example Proxy Config\n\n```xml\n<?xml version='1.0' encoding='UTF-8'?>\n<CONF version=\"2\">\n    <server>\n        <rproxy>\n            <enabled>true</enabled>\n            <rules>\n                <rule>\n                    <udp_port_reuse>false</udp_port_reuse>\n                    <squash_user>xfer</squash_user>\n                    <keyfile>/opt/aspera/proxy/etc/asperaweb_id_dsa.openssh</keyfile>\n                    <host>{aspera-tcp-proxy-address}:33001</host>\n                    <bind_source_address>{proxy_internal_interface}</bind_source_address>\n                </rule>\n            </rules>\n        </rproxy>\n    </server>\n</CONF>\n```\n","fileAbsolutePath":"/Users/asim/MCM/learning-site/local-test-only-branch/cp4mcm-swat-kb/src/pages/cp4i-guides/aspera-proxy-cp4i/index.mdx"}}},"staticQueryHashes":["1364590287","2102389209","2102389209","2456312558","2746626797","2746626797","3018647132","3018647132","3037994772","3037994772","3159585216","63531786","63531786","768070550"]}